<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AES Visualizer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=3">
    <!-- Google Fonts for modern look -->
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <a href="/" class="home-btn"><i class="fas fa-arrow-left"></i> Menu</a>
            <h1>AES-128 Visualizer</h1>
            <p>Advanced Encryption Standard: Sicurezza "Militare" attraverso Matematica & Struttura</p>
        </header>

        <!-- Advanced Concepts Section (University Grade) -->
        <div class="concept-section">
            <!-- 1. The State Matrix -->
            <div class="concept-box">
                <div class="concept-title"><i class="fas fa-th"></i> The State Matrix</div>
                <p>AES non lavora su una striscia di bit, ma su una <strong>Matrice 4x4</strong> di Byte.</p>
                <div class="state-grid-visual">
                    <div class="state-cell-visual" style="border-color: var(--accent);">0</div>
                    <div class="state-cell-visual">4</div>
                    <div class="state-cell-visual">8</div>
                    <div class="state-cell-visual">12</div>
                    <div class="state-cell-visual" style="border-color: var(--accent);">1</div>
                    <div class="state-cell-visual">5</div>
                    <div class="state-cell-visual">9</div>
                    <div class="state-cell-visual">13</div>
                    <div class="state-cell-visual" style="border-color: var(--accent);">2</div>
                    <div class="state-cell-visual">6</div>
                    <div class="state-cell-visual">10</div>
                    <div class="state-cell-visual">14</div>
                    <div class="state-cell-visual" style="border-color: var(--accent);">3</div>
                    <div class="state-cell-visual">7</div>
                    <div class="state-cell-visual">11</div>
                    <div class="state-cell-visual">15</div>
                </div>
                <p style="font-size: 0.85rem; color: var(--text-secondary);">I 128 bit (16 byte) riempiono la matrice
                    <em>per colonna</em>. ShiftRows lavora sulle righe, MixColumns sulle colonne.
                </p>
            </div>

            <!-- 2. Galois Fields (Deep Dive) -->
            <div class="concept-box" style="grid-column: 1 / -1;">
                <div class="concept-title"><i class="fas fa-calculator"></i> Advanced Encryption Standard (AES) - Il
                    Motore Matematico</div>

                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 300px;">
                        <h4 style="color: #58a6ff; margin-bottom: 10px;">1. Il Polinomio Irriducibile (Da imparare a
                            memoria)</h4>

                        <div
                            style="background: rgba(88, 166, 255, 0.1); border-left: 3px solid #58a6ff; padding: 10px; margin-bottom: 10px; font-size: 0.9em;">
                            <strong>Il Problema:</strong> Se in un computer fai 200 x 200, ottieni 40.000. Questo numero
                            richiede 16 bit (2 byte). <br>
                            Ma AES deve lavorare sempre dentro <strong>1 byte (8 bit)</strong>.
                        </div>

                        <div
                            style="background: rgba(63, 185, 80, 0.1); border-left: 3px solid #3fb950; padding: 10px; margin-bottom: 15px; font-size: 0.9em;">
                            <strong>La Soluzione:</strong> Usare un Campo Finito (Galois Field)
                            <strong>GF(2<sup>8</sup>)</strong>. <br>
                            I byte sono visti come polinomi. Le operazioni avvengono <em>modulo</em> un Polinomio
                            Irriducibile <a href="#" title="m(x) = x^8 + x^4 + x^3 + x + 1"
                                style="color:#58a6ff; text-decoration:none;">(?)</a>. <br>
                            <strong>Risultato:</strong> Qualsiasi operazione matematica fai, il risultato "rimbalza" e
                            rientra sempre in 8 bit.
                        </div>

                        <div class="math-note expanded"
                            style="background: #0d1117; padding: 15px; border-radius: 6px; border: 1px solid #30363d; margin: 15px 0; text-align: center;">
                            <span style="color: #a371f7; font-size: 1.2em;">m(x) = x<sup>8</sup> + x<sup>4</sup> +
                                x<sup>3</sup> + x + 1</span>
                            <div style="margin-top: 5px; font-size: 0.8em; color: #8b949e;">(Se lo scrivi alla lavagna o
                                lo citi, il 30 è garantito)</div>
                        </div>
                    </div>

                    <div style="flex: 1; min-width: 300px;">
                        <h4 style="color: #3fb950; margin-bottom: 10px;">2. Le 4 Fasi del Round (Ordine Esatto)</h4>
                        <ul style="list-style: none; padding: 0; margin: 0;">
                            <li style="margin-bottom: 10px; border-left: 3px solid #ff7b72; padding-left: 10px;">
                                <strong style="color: #ff7b72;">SubBytes</strong>: Sostituzione non lineare (S-Box).
                                <br>
                                <span style="font-size: 0.9em; color: #8b949e;">È l'unica fase non lineare! Serve a
                                    distruggere le strutture statistiche (<strong>Confusione</strong>).</span>
                            </li>
                            <li style="margin-bottom: 10px; border-left: 3px solid #d29922; padding-left: 10px;">
                                <strong style="color: #d29922;">ShiftRows</strong>: Permutazione delle righe. <br>
                                <span style="font-size: 0.9em; color: #8b949e;">(Riga 0: shift 0; Riga 1: shift
                                    1...).</span>
                            </li>
                            <li style="margin-bottom: 10px; border-left: 3px solid #a371f7; padding-left: 10px;">
                                <strong style="color: #a371f7;">MixColumns</strong>: Mescola i dati nelle colonne usando
                                la matematica di Galois. <br>
                                <span style="font-size: 0.9em; color: #8b949e;">Serve a spargere l'informazione
                                    (<strong>Diffusione</strong>).</span>
                            </li>
                            <li style="margin-bottom: 10px; border-left: 3px solid #79c0ff; padding-left: 10px;">
                                <strong style="color: #79c0ff;">AddRoundKey</strong>: XOR con la chiave del round.
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 3. Key Expansion -->
            <div class="concept-box">
                <div class="concept-title"><i class="fas fa-key"></i> Key Expansion</div>
                <p>La chiave originale (128 bit) viene espansa in <strong>11 Round Keys</strong>.</p>
                <div class="key-expansion-visual">
                    <span class="key-round">K<sub>0</sub></span> <i class="fas fa-arrow-right"
                        style="font-size: 0.8rem; color: var(--text-secondary);"></i>
                    <span class="key-round">g(K)</span> <i class="fas fa-arrow-right"
                        style="font-size: 0.8rem; color: var(--text-secondary);"></i>
                    <span class="key-round">K<sub>1</sub>...K<sub>10</sub></span>
                </div>
                <ul style="font-size: 0.85rem; padding-left: 1.2rem; color: var(--text-secondary);">
                    <li><strong>RotWord:</strong> Rotazione byte</li>
                    <li><strong>SubWord:</strong> S-Box sulla chiave</li>
                    <li><strong>Rcon:</strong> Aggiunta costante (Round Constant)</li>
                </ul>
            </div>

            <!-- 4. AES Variants Table -->
            <div class="concept-box">
                <div class="concept-title"><i class="fas fa-table"></i> Varianti AES</div>
                <table class="variants-table">
                    <thead>
                        <tr>
                            <th>Ver</th>
                            <th>Key Len</th>
                            <th>Rounds</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AES-128</td>
                            <td>128 bit</td>
                            <td>10</td>
                        </tr>
                        <tr>
                            <td>AES-192</td>
                            <td>192 bit</td>
                            <td>12</td>
                        </tr>
                        <tr>
                            <td>AES-256</td>
                            <td>256 bit</td>
                            <td>14</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 5. SPN Alert -->
            <div class="concept-box" style="grid-column: 1 / -1;">
                <div class="concept-title"><i class="fas fa-exclamation-triangle"></i> Architettura</div>
                <div class="spn-alert">
                    <strong>ATTENZIONE:</strong> AES <strong>NON</strong> usa la Rete di Feistel (come il DES).<br>
                    AES è una rete <strong>SPN (Substitution-Permutation Network)</strong>.<br>
                    Durante la decifratura, non basta invertire l'ordine delle chiavi, ma servono le operazioni inverse
                    (InvSubBytes, InvShiftRows, etc.).
                </div>
            </div>
        </div>


        <div class="input-section">
            <div class="input-group">
                <label for="plaintext">Testo in Chiaro (Plaintext)</label>
                <input type="text" id="plaintext" placeholder="Es: Hello World" value="Hello World">
            </div>
            <div class="input-group">
                <label for="key">Chiave (Key)</label>
                <input type="text" id="key" placeholder="Es: SecretKey123" value="SecretKey123">
            </div>
            <button id="encrypt-btn" onclick="runEncryption()">Esegui AES</button>
        </div>

        <div id="results" class="results-section hidden">
            <div class="summary">
                <div class="hex-display">
                    <h3>Input Hex</h3>
                    <code id="input-hex"></code>
                </div>
                <div class="hex-display">
                    <h3>Key Hex (First block)</h3>
                    <code id="key-hex"></code>
                </div>
            </div>

            <div id="steps-container">
                <!-- Steps will be injected here -->
            </div>
        </div>
    </div>

    <div style="text-align: center; margin-top: 50px; margin-bottom: 20px;">
        <a href="/" style="text-decoration: none;">
            <button
                style="padding: 10px 20px; font-size: 1em; background: #30363d; color: #fff; border: 1px solid #8b949e; border-radius: 6px; cursor: pointer;">
                <i class="fas fa-arrow-left"></i> Torna al Menu
            </button>
        </a>
    </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}?v=3"></script>
</body>

</html>